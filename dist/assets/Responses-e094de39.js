import{r as d,j,l as E,o as a,c as l,b as e,d as x,s as m,F as f,h as _,t as n,e as g,f as p,i as w,m as T,p as B}from"./index-d28b8463.js";import{f as P}from"./index-c4405eea.js";const $={class:"card mb-6"},z={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},F=["value"],L=["value"],U={class:"card"},H={class:"overflow-x-auto"},I={class:"min-w-full divide-y divide-gray-200"},W={class:"bg-white divide-y divide-gray-200"},Y={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},q={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},G={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},J={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},K={key:0,class:"text-gray-900"},O={key:1,class:"text-gray-600"},Q={key:2,class:"text-gray-400"},X={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Z={key:0,class:"flex items-center space-x-2"},ee=["onClick"],te={key:1,class:"text-gray-400"},se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},oe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},ae={key:0,class:"px-6 py-3 border-t border-gray-200"},le={class:"flex items-center justify-between"},ne={class:"text-sm text-gray-700"},re={class:"flex space-x-2"},ie={key:0,class:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50"},de={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md"},ue={key:0,class:"space-y-4"},pe={class:"text-sm text-gray-600"},ce={class:"bg-gray-50 rounded-lg p-4"},ge=["src"],fe={__name:"Responses",setup(ve){const b=d([]),k=d([]),h=d([]),u=d({survey_id:"",date_range:"",agent_id:""}),r=d({current_page:1,per_page:20,total:0,from:0,to:0,last_page:1}),y=d(!1),i=d(null),v=d(null),V=o=>P(new Date(o*1e3),"MMM dd, yyyy HH:mm"),M=o=>{i.value=o,y.value=!0},C=()=>{y.value=!1,i.value=null,v.value&&(v.value.pause(),v.value.currentTime=0)},N=o=>{console.error("Audio playback error:",o)},R=async()=>{try{const o=await w.get("/surveys");k.value=o.data.data}catch(o){console.error("Error loading surveys:",o)}},S=async()=>{try{const o=await w.get("/agents");h.value=o.data.data}catch(o){console.error("Error loading agents:",o)}},c=async()=>{try{const o={page:r.value.current_page,...u.value},t=await w.get("/responses",{params:o});b.value=t.data.data,r.value=t.data.pagination||r.value}catch(o){console.error("Error loading responses:",o)}},A=o=>{r.value.current_page=o,c()};return j(()=>{R(),S(),c()}),(o,t)=>{const D=E("router-link");return a(),l("div",null,[t[22]||(t[22]=e("div",{class:"mb-8"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Survey Responses"),e("p",{class:"text-gray-600"},"View and analyze survey responses")],-1)),e("div",$,[e("div",z,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Survey ",-1)),x(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>u.value.survey_id=s),class:"input-field",onChange:c},[t[5]||(t[5]=e("option",{value:""},"All Surveys",-1)),(a(!0),l(f,null,_(k.value,s=>(a(),l("option",{key:s.id,value:s.id},n(s.title),9,F))),128))],544),[[m,u.value.survey_id]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Date Range ",-1)),x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>u.value.date_range=s),class:"input-field",onChange:c},t[7]||(t[7]=[e("option",{value:""},"All Time",-1),e("option",{value:"today"},"Today",-1),e("option",{value:"week"},"This Week",-1),e("option",{value:"month"},"This Month",-1)]),544),[[m,u.value.date_range]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Agent ",-1)),x(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>u.value.agent_id=s),class:"input-field",onChange:c},[t[9]||(t[9]=e("option",{value:""},"All Agents",-1)),(a(!0),l(f,null,_(h.value,s=>(a(),l("option",{key:s.id,value:s.id},n(s.username),9,L))),128))],544),[[m,u.value.agent_id]])])])]),e("div",U,[e("div",H,[e("table",I,[t[13]||(t[13]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Survey "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Agent "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Respondent "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Location "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Voice "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Date "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",W,[(a(!0),l(f,null,_(b.value,s=>(a(),l("tr",{key:s.id},[e("td",Y,n(s.survey_title),1),e("td",q,n(s.agent_name),1),e("td",G,n(s.respondent_name||"N/A"),1),e("td",J,[s.location_address?(a(),l("span",K,n(s.location_address),1)):s.latitude&&s.longitude?(a(),l("span",O,n(s.latitude.toFixed(4))+", "+n(s.longitude.toFixed(4)),1)):(a(),l("span",Q,"No location"))]),e("td",X,[s.has_voice_recording?(a(),l("div",Z,[e("button",{onClick:ye=>M(s),class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 hover:bg-green-200 cursor-pointer"},t[11]||(t[11]=[e("svg",{class:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"})],-1),p(" Play Voice ")]),8,ee)])):(a(),l("span",te,"No voice"))]),e("td",se,n(V(s.created_at)),1),e("td",oe,[T(D,{to:`/responses/${s.id}`,class:"text-primary-600 hover:text-primary-900"},{default:B(()=>t[12]||(t[12]=[p(" View Details ")])),_:2,__:[12]},1032,["to"])])]))),128))])])]),r.value.total>r.value.per_page?(a(),l("div",ae,[e("div",le,[e("div",ne," Showing "+n(r.value.from)+" to "+n(r.value.to)+" of "+n(r.value.total)+" results ",1),e("div",re,[r.value.current_page>1?(a(),l("button",{key:0,onClick:t[3]||(t[3]=s=>A(r.value.current_page-1)),class:"btn-secondary"}," Previous ")):g("",!0),r.value.current_page<r.value.last_page?(a(),l("button",{key:1,onClick:t[4]||(t[4]=s=>A(r.value.current_page+1)),class:"btn-secondary"}," Next ")):g("",!0)])])])):g("",!0)]),y.value?(a(),l("div",ie,[e("div",de,[e("div",{class:"flex justify-between items-center mb-4"},[t[15]||(t[15]=e("h3",{class:"text-lg font-bold text-gray-900"},"Voice Recording",-1)),e("button",{onClick:C,class:"text-gray-400 hover:text-gray-600"},t[14]||(t[14]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),i.value?(a(),l("div",ue,[e("div",pe,[e("p",null,[t[16]||(t[16]=e("strong",null,"Survey:",-1)),p(" "+n(i.value.survey_title),1)]),e("p",null,[t[17]||(t[17]=e("strong",null,"Respondent:",-1)),p(" "+n(i.value.respondent_name||"N/A"),1)]),e("p",null,[t[18]||(t[18]=e("strong",null,"Agent:",-1)),p(" "+n(i.value.agent_name),1)]),e("p",null,[t[19]||(t[19]=e("strong",null,"Date:",-1)),p(" "+n(V(i.value.created_at)),1)])]),e("div",ce,[e("audio",{ref_key:"audioPlayer",ref:v,controls:"",class:"w-full",onError:N},[e("source",{src:`https://janmat.netserve.in/${i.value.voice_recording}`,type:"audio/webm"},null,8,ge),t[20]||(t[20]=p(" Your browser does not support the audio element. "))],544),t[21]||(t[21]=e("p",{class:"text-xs text-gray-500 mt-2"}," If the audio doesn't play, the file might be corrupted or in an unsupported format. ",-1))])])):g("",!0),e("div",{class:"flex justify-end mt-6"},[e("button",{onClick:C,class:"btn-secondary"}," Close ")])])])):g("",!0)])}}};export{fe as default};
