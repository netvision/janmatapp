import{z as D,u as U,r as y,k as z,x as F,o as n,c as a,b as e,q as I,y as L,f as E,t as u,F as w,h as k,e as x,w as P,d as q,v as j,m as Y,p as G,A as H,i as b,s as N}from"./index-b838ad82.js";const J={class:"container mx-auto px-4 py-8"},K={class:"max-w-6xl mx-auto"},W={class:"flex items-center justify-between mb-6"},X={key:0,class:"text-center py-8"},Z={key:1},ee={class:"mb-6 flex justify-between items-center"},te={class:"text-lg font-semibold"},se={class:"text-primary-600"},oe={key:0,class:"mb-8"},le={class:"bg-white rounded-lg shadow"},ne={class:"p-6 border-b border-gray-200"},ae={class:"text-sm text-gray-600 mt-1"},ie={class:"p-6"},re={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},de={class:"font-medium text-gray-900 mb-3"},ue={key:0},ce={key:0,class:"space-y-2"},pe={class:"flex-1"},ye={class:"flex justify-between text-sm"},ve={class:"text-gray-700"},ge={class:"text-gray-500"},me={class:"w-full bg-gray-200 rounded-full h-2 mt-1"},xe={key:1,class:"text-gray-500 text-sm"},be={key:1,class:"space-y-2"},he={class:"flex-1"},_e={class:"flex justify-between text-sm"},fe={class:"text-gray-700 truncate"},we={class:"text-gray-500 ml-2"},ke={class:"w-full bg-gray-200 rounded-full h-2 mt-1"},qe={key:2,class:"text-gray-500 text-sm"},Ce={key:1,class:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6"},Qe={class:"text-yellow-700 text-sm mt-1"},$e={key:2,class:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6"},Se={class:"text-sm text-gray-600"},Te={class:"space-y-4 mb-8"},Ee={class:"flex-1 mr-4"},je={class:"font-medium text-gray-900 text-lg mb-2"},Ne={class:"text-sm text-gray-600 mb-1"},Me={key:0,class:"text-xs text-gray-500"},Re={class:"flex space-x-2 flex-shrink-0"},Ve=["onClick"],Ae=["onClick"],Oe={class:"flex flex-col space-y-1"},Be=["onClick","disabled"],De=["onClick","disabled"],Ue={key:3,class:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50"},ze={class:"bg-white rounded-lg shadow-lg p-6 w-full max-w-lg relative"},Fe={class:"text-lg font-bold mb-4"},Ie={class:"mb-4"},Le={class:"mb-4"},Pe={key:0,class:"mb-4"},Ye={class:"mb-4"},Ge={class:"inline-flex items-center"},Ke={__name:"SurveyQuestions",setup(He){const M=D();U();const h=M.params.id,C=y(!0),c=y([]),Q=y(""),_=y(!1),v=y(null),d=y({text:"",type:"text",required:!1,options:""}),g=y(null),f=async()=>{var l,t,r;C.value=!0;try{const[s,o]=await Promise.all([b.get(`/surveys/${h}`),b.get(`/responses/analytics?survey_id=${h}`)]);console.log("Questions response:",s.data),Q.value=s.data.data.title,c.value=(s.data.data.questions||[]).map(i=>({...i,options:Array.isArray(i.options)?i.options:[]})),console.log("Processed questions:",c.value),g.value=o.data.data}catch(s){console.error("Error fetching questions:",((l=s.response)==null?void 0:l.data)||s.message),alert("Error loading questions: "+(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||s.message))}finally{C.value=!1}},$=()=>{_.value=!1,v.value=null,d.value={text:"",type:"text",required:!1,options:""}},R=async()=>{var t,r,s;const l={text:d.value.text,type:d.value.type,required:d.value.required?1:0,options:["select","radio","checkbox"].includes(d.value.type)?d.value.options.split(",").map(o=>o.trim()).filter(Boolean):[]};try{if(v.value!==null){const o=c.value[v.value];await b.put(`/questions/${o.id}/update`,l),alert("Question updated successfully!")}else await b.post(`/surveys/${h}/questions/create`,l),alert("Question added successfully!");await f(),$()}catch(o){console.error("Error saving question:",((t=o.response)==null?void 0:t.data)||o.message),alert("Error saving question: "+(((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.message)||o.message))}},V=l=>{console.log("Edit question clicked:",l,c.value[l]),v.value=l;const t=c.value[l],r=s=>{switch(s){case"text":return"text";case"single_choice":return"radio";case"multiple_choice":return"checkbox";case"rating":return"select";default:return"text"}};d.value={text:t.text,type:r(t.type),required:t.required,options:(t.options||[]).join(", ")},_.value=!1},A=async l=>{var s,o,i;console.log("Delete question clicked:",l);const t=c.value.find(p=>p.id===l),r=t?t.text.substring(0,50)+(t.text.length>50?"...":""):"this question";if(confirm(`Are you sure you want to delete "${r}"? This action cannot be undone.`))try{await b.post(`/questions/${l}/delete`),alert("Question deleted successfully!"),await f()}catch(p){console.error("Error deleting question:",((s=p.response)==null?void 0:s.data)||p.message),alert("Error deleting question: "+(((i=(o=p.response)==null?void 0:o.data)==null?void 0:i.message)||p.message))}},S=async(l,t)=>{var i,p,T;if(t==="up"&&l===0||t==="down"&&l===c.value.length-1)return;const r=[...c.value],s=t==="up"?l-1:l+1,o=r[l];r[l]=r[s],r[s]=o;try{const m=r.map(B=>B.id);await b.post(`/surveys/${h}/questions/reorder`,{order:m}),await f()}catch(m){console.error("Error reordering questions:",((i=m.response)==null?void 0:i.data)||m.message),alert("Error reordering questions: "+(((T=(p=m.response)==null?void 0:p.data)==null?void 0:T.message)||m.message))}},O=l=>({text:"Text",number:"Number",select:"Select",radio:"Radio",checkbox:"Checkbox",multiple_choice:"Multiple Choice",single_choice:"Single Choice",rating:"Rating"})[l]||l;return z(()=>{f()}),(l,t)=>{const r=F("router-link");return n(),a("div",J,[e("div",K,[e("div",W,[t[6]||(t[6]=e("h1",{class:"text-2xl font-bold text-gray-900"},"Manage Questions",-1)),I(r,{to:"/surveys",class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors"},{default:L(()=>t[5]||(t[5]=[E(" Back to Surveys ")])),_:1,__:[5]})]),C.value?(n(),a("div",X,t[7]||(t[7]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Loading questions...",-1)]))):(n(),a("div",Z,[e("div",ee,[e("h2",te,[t[8]||(t[8]=E("Questions for: ")),e("span",se,u(Q.value),1)]),e("button",{onClick:t[0]||(t[0]=s=>_.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"},"Add Question")]),g.value&&g.value.questions&&g.value.questions.length>0?(n(),a("div",oe,[e("div",le,[e("div",ne,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Survey Analytics",-1)),e("p",ae,u(g.value.total_responses)+" total responses",1)]),e("div",ie,[e("div",re,[(n(!0),a(w,null,k(g.value.questions,s=>(n(),a("div",{key:s.question_id,class:"border rounded-lg p-4"},[e("h4",de,u(s.question_text),1),s.question_type==="single_choice"||s.question_type==="multiple_choice"||s.question_type==="rating"?(n(),a("div",ue,[Object.keys(s.answers).length>0?(n(),a("div",ce,[(n(!0),a(w,null,k(s.answers,(o,i)=>(n(),a("div",{key:i,class:"flex items-center"},[e("div",pe,[e("div",ye,[e("span",ve,u(i),1),e("span",ge,u(o),1)]),e("div",me,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:N({width:`${o/s.total_answers*100}%`})},null,4)])])]))),128))])):(n(),a("div",xe,"No responses yet"))])):Object.keys(s.text_answers).length>0?(n(),a("div",be,[(n(!0),a(w,null,k(s.text_answers,(o,i)=>(n(),a("div",{key:i,class:"flex items-center"},[e("div",he,[e("div",_e,[e("span",fe,u(i),1),e("span",we,u(o),1)]),e("div",ke,[e("div",{class:"bg-green-600 h-2 rounded-full",style:N({width:`${o/s.total_answers*100}%`})},null,4)])])]))),128))])):(n(),a("div",qe,"No responses yet"))]))),128))])])])])):x("",!0),c.value.length===0?(n(),a("div",Ce,[t[10]||(t[10]=e("p",{class:"font-medium text-yellow-800"},"No questions found for this survey.",-1)),e("p",Qe,"Questions loaded: "+u(c.value.length),1)])):x("",!0),c.value.length>0?(n(),a("div",$e,[e("p",Se,"Debug: "+u(c.value.length)+" questions loaded",1)])):x("",!0),e("div",Te,[(n(!0),a(w,null,k(c.value,(s,o)=>(n(),a("div",{key:s.id,class:"bg-white shadow rounded-lg p-6 flex justify-between items-start hover:shadow-md transition-shadow"},[e("div",Ee,[e("div",je,u(o+1)+". "+u(s.text),1),e("div",Ne,"Type: "+u(O(s.type))+" | Required: "+u(s.required?"Yes":"No"),1),s.options&&s.options.length?(n(),a("div",Me,"Options: "+u(s.options.join(", ")),1)):x("",!0)]),e("div",Re,[e("button",{onClick:i=>V(o),class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm hover:shadow-md"}," âœï¸ Edit ",8,Ve),e("button",{onClick:i=>A(s.id),class:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm hover:shadow-md"}," ðŸ—‘ï¸ Delete ",8,Ae),e("div",Oe,[e("button",{onClick:i=>S(o,"up"),disabled:o===0,class:"bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-2 py-1 rounded text-xs transition-colors"}," â†‘ ",8,Be),e("button",{onClick:i=>S(o,"down"),disabled:o===c.value.length-1,class:"bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white px-2 py-1 rounded text-xs transition-colors"}," â†“ ",8,De)])])]))),128))]),_.value||v.value!==null?(n(),a("div",Ue,[e("div",ze,[e("h3",Fe,u(v.value!==null?"Edit":"Add")+" Question",1),e("form",{onSubmit:P(R,["prevent"])},[e("div",Ie,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Question Text",-1)),q(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>d.value.text=s),type:"text",class:"w-full px-3 py-2 border rounded"},null,512),[[j,d.value.text]])]),e("div",Le,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Type",-1)),q(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>d.value.type=s),class:"w-full px-3 py-2 border rounded"},t[12]||(t[12]=[G('<option value="text">Text</option><option value="number">Number</option><option value="select">Select</option><option value="radio">Radio</option><option value="checkbox">Checkbox</option>',5)]),512),[[Y,d.value.type]])]),["select","radio","checkbox"].includes(d.value.type)?(n(),a("div",Pe,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Options (comma separated)",-1)),q(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>d.value.options=s),type:"text",class:"w-full px-3 py-2 border rounded",placeholder:"Option 1, Option 2, Option 3"},null,512),[[j,d.value.options]])])):x("",!0),e("div",Ye,[e("label",Ge,[q(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>d.value.required=s),type:"checkbox",class:"form-checkbox"},null,512),[[H,d.value.required]]),t[15]||(t[15]=e("span",{class:"ml-2"},"Required",-1))])]),e("div",{class:"flex justify-end space-x-2"},[e("button",{type:"button",onClick:$,class:"bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded"},"Cancel"),t[16]||(t[16]=e("button",{type:"submit",class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded"},"Save",-1))])],32)])])):x("",!0)]))])])}}};export{Ke as default};
