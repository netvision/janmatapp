import{u as y,o as A,a as E,c as S,b as w,d as I,r as L,e as P,f as p,g as O,h as k,i as R,j as b,k as q}from"./vendor-740be9e2.js";import{a as T}from"./utils-917b1704.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function s(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(o){if(o.ep)return;o.ep=!0;const t=s(o);fetch(o.href,t)}})();const B={id:"app",class:"min-h-screen bg-gray-50"},N={class:"safe-area"},V={__name:"App",setup(e){const r=y();return A(()=>{document.body.style.overscrollBehavior="none",window.history&&window.history.pushState&&window.addEventListener("popstate",()=>{r.currentRoute.value.name==="login"&&r.push("/login")})}),(s,i)=>{const o=L("router-view");return E(),S("div",B,[w("div",N,[I(o)])])}}},D="modulepreload",j=function(e){return"/"+e},_={},m=function(r,s,i){if(!s||s.length===0)return r();const o=document.getElementsByTagName("link");return Promise.all(s.map(t=>{if(t=j(t),t in _)return;_[t]=!0;const n=t.endsWith(".css"),l=n?'[rel="stylesheet"]':"";if(!!i)for(let c=o.length-1;c>=0;c--){const a=o[c];if(a.href===t&&(!n||a.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${t}"]${l}`))return;const u=document.createElement("link");if(u.rel=n?"stylesheet":D,n||(u.as="script",u.crossOrigin=""),u.href=t,document.head.appendChild(u),n)return new Promise((c,a)=>{u.addEventListener("load",c),u.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>r()).catch(t=>{const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=t,window.dispatchEvent(n),!n.defaultPrevented)throw t})},h=T.create({baseURL:"https://janmat.netserve.in/api/v1",headers:{"Content-Type":"application/json"}});h.interceptors.request.use(e=>{const r=localStorage.getItem("agent_token");return r&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));h.interceptors.response.use(e=>e,e=>{var r;return((r=e.response)==null?void 0:r.status)===401&&(localStorage.removeItem("agent_token"),localStorage.removeItem("agent_user"),window.location.pathname!=="/login"&&(window.location.href="/login")),Promise.reject(e)});const g=P("auth",()=>{const e=p(null),r=p(localStorage.getItem("agent_token")||null),s=p(!1),i=O(()=>!!r.value&&!!e.value);return{user:e,token:r,loading:s,isAuthenticated:i,login:async(l,d)=>{var u,c;s.value=!0;try{const a=await h.post("/auth/login",{username:l,password:d});return a.data.success?(r.value=a.data.token,e.value=a.data.user,localStorage.setItem("agent_token",r.value),localStorage.setItem("agent_user",JSON.stringify(e.value)),{success:!0}):{success:!1,message:a.data.message}}catch(a){return{success:!1,message:((c=(u=a.response)==null?void 0:u.data)==null?void 0:c.message)||"Login failed"}}finally{s.value=!1}},logout:()=>{r.value=null,e.value=null,localStorage.removeItem("agent_token"),localStorage.removeItem("agent_user")},initializeAuth:()=>{const l=localStorage.getItem("agent_token"),d=localStorage.getItem("agent_user");l&&d&&(r.value=l,e.value=JSON.parse(d))}}}),C=[{path:"/",redirect:"/login"},{path:"/login",name:"login",component:()=>m(()=>import("./Login-63c40b0e.js"),["assets/Login-63c40b0e.js","assets/vendor-740be9e2.js","assets/utils-917b1704.js"]),meta:{requiresAuth:!1}},{path:"/dashboard",name:"dashboard",component:()=>m(()=>import("./Dashboard-863f691f.js"),["assets/Dashboard-863f691f.js","assets/vendor-740be9e2.js","assets/utils-917b1704.js"]),meta:{requiresAuth:!0}},{path:"/surveys",name:"surveys",component:()=>m(()=>import("./Surveys-b404b146.js"),["assets/Surveys-b404b146.js","assets/vendor-740be9e2.js","assets/utils-917b1704.js"]),meta:{requiresAuth:!0}},{path:"/survey/:id",name:"survey",component:()=>m(()=>import("./Survey-e3f93267.js").then(e=>e.S),["assets/Survey-e3f93267.js","assets/vendor-740be9e2.js"]),meta:{requiresAuth:!0}},{path:"/response/:id",name:"response",component:()=>m(()=>import("./Response-669ee2da.js"),["assets/Response-669ee2da.js","assets/vendor-740be9e2.js"]),meta:{requiresAuth:!0}},{path:"/profile",name:"profile",component:()=>m(()=>import("./Profile-5a77377c.js"),["assets/Profile-5a77377c.js","assets/vendor-740be9e2.js","assets/utils-917b1704.js"]),meta:{requiresAuth:!0}}],v=k({history:R(),routes:C});v.beforeEach((e,r,s)=>{const i=g();e.meta.requiresAuth&&!i.isAuthenticated?s("/login"):e.name==="login"&&i.isAuthenticated?s("/dashboard"):s()});const f=b(V),z=q();f.use(z);f.use(v);const U=g();U.initializeAuth();f.mount("#app");export{m as _,h as a,g as u};
